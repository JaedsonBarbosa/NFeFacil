<Page x:Class="NFeFacil.View.Configuracoes"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:VM="using:NFeFacil.ViewModel"
      xmlns:Conversores="using:NFeFacil.ViewModel.Converters"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d">
    <Page.Resources>
        <ResourceDictionary>
            <Conversores:BoolToVisibility x:Key="boolView"></Conversores:BoolToVisibility>
        </ResourceDictionary>
    </Page.Resources>
    <Page.DataContext>
        <VM:ConfiguracoesDataContext />
    </Page.DataContext>
    <FlipView x:Name="main"
              Padding="16"
              Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <StackPanel>
            <TextBlock Style="{StaticResource BodyTextBlockStyle}">Escolha o certificado que será usado para realizar a conexão com os servidores da SEFAZ e para a assinatura das notas fiscais.</TextBlock>
            <Button Command="{Binding ImportarCertificado}"
                    HorizontalAlignment="Stretch">Importar certificado A1</Button>
            <Button Command="{Binding ConectarServidor}"
                    HorizontalAlignment="Stretch">Conectar a servidor de certificação</Button>
            <Button Command="{Binding EsquecerServidor}"
                    IsEnabled="{Binding ServidorCadastrado}"
                    HorizontalAlignment="Stretch">Esquecer servidor de certificação</Button>
            <Button Command="{Binding InstalarServidor}"
                    IsEnabled="{Binding InstalacaoLiberada, Mode=OneTime}"
                    HorizontalAlignment="Stretch">Instalar servidor de certificação</Button>
            <ListView ItemsSource="{Binding ListaCertificados, Mode=OneWay}"
                      BorderThickness="2"
                      BorderBrush="{StaticResource Normal}">
                <ListView.Header>
                    <TextBlock TextAlignment="Center"
                               Style="{StaticResource SubtitleTextBlockStyle}">Certificados importados</TextBlock>
                </ListView.Header>
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Subject}">
                            <TextBlock.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem Command="{Binding ElementName=main, Path=DataContext.RemoverCertificado}"
                                                    CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}}">Remover</MenuFlyoutItem>
                                </MenuFlyout>
                            </TextBlock.ContextFlyout>
                        </TextBlock>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </StackPanel>
        <ScrollViewer VerticalScrollBarVisibility="Hidden">
            <StackPanel>
                <RichTextBlock Margin="0">
                    <Paragraph>
                        <Run Text="Você também pode importar informações, como emitentes ou clientes, cadastrados em outros aplicativos ou notas fiscais emitidas por qualquer programa." />
                    </Paragraph>
                </RichTextBlock>
                <ItemsControl Style="{StaticResource ItensResponsivos}">
                    <StackPanel>
                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}"
                                   Margin="0,10,0,0">Importar dado base</TextBlock>
                        <RichTextBlock>
                            <Paragraph>
                                <Run Text="Escolha o tipo de dado que você quer importar e clique em Importar. Então, uma caixa de diálogo será aberta e você poderá escolher em quais arquivos XML estão as informações desejadas." />
                            </Paragraph>
                            <Paragraph>
                                <Run Text="Por favor, para evitar erros, após clicar em Abrir na caixa que se abrirá espere até a mensagem de sucesso ser exibida." />
                            </Paragraph>
                        </RichTextBlock>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <ComboBox ItemsSource="{Binding TiposBásicos, Mode=OneTime}"
                                      SelectedItem="{Binding TipoBásicoSelecionado, Mode=TwoWay}"
                                      HorizontalAlignment="Stretch" />
                            <Button Grid.Column="1"
                                    HorizontalAlignment="Stretch"
                                    Command="{Binding ImportarDadoBaseCommand}">Importar</Button>
                        </Grid>
                    </StackPanel>
                    <StackPanel>
                        <TextBlock Margin="0,10,0,0"
                                   Style="{StaticResource SubtitleTextBlockStyle}">Importar nota fiscal</TextBlock>
                        <TextBlock TextWrapping="Wrap">Para importar notas fiscais você só precisa clicar no botão abaixo e, na janela que se abrirá, escolha as notas fiscais que deverão ser importadas.</TextBlock>
                        <Button HorizontalAlignment="Stretch"
                                Command="{Binding ImportarNotaFiscalCommand}">Importar</Button>
                    </StackPanel>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </FlipView>
</Page>
