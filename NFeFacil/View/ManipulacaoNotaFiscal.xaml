<Page x:Class="NFeFacil.View.ManipulacaoNotaFiscal"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:NFeFacil.View"
      xmlns:VM="using:NFeFacil.ViewModel"
      xmlns:ctrls="using:NFeFacil.View.Controles"
      xmlns:DadosBase="using:NFeFacil.View.TelasDadosBase"
      xmlns:Conversores="using:NFeFacil.ViewModel.Converters"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d">
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Estilos/GridResponsiva.xaml" />
                <ResourceDictionary Source="Estilos/PivotPrincipal.xaml" />
                <ResourceDictionary Source="Estilos/Tabela.xaml" />
                <ResourceDictionary Source="Estilos/EstilosExtras.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <VM:DadosEstadosParaView x:Key="estados" />
            <Conversores:ColecaoValida x:Key="getObs" />
            <Storyboard x:Name="ocultarGrid">
                <DoubleAnimation Duration="0:0:0.25"
                                 To="0"
                                 Storyboard.TargetProperty="(UIElement.Opacity)"
                                 Storyboard.TargetName="grdPrincipal" />
            </Storyboard>
            <Style x:Key="ListaCheia"
                   TargetType="ListView">
                <Setter Property="ItemContainerStyle">
                    <Setter.Value>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Stretch" />
                        </Style>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Page.Resources>
    <Grid x:Name="grdPrincipal" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Pivot x:Name="pvtPrincipal">
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Symbol="Tag"
                                Label="Dados" />
                </PivotItem.Header>
                <ScrollViewer ScrollViewer.VerticalScrollBarVisibility="Hidden">
                    <StackPanel DataContext="{Binding Dados}">
                        <StackPanel.Resources>
                            <Style TargetType="TextBox">
                                <Setter Property="HorizontalAlignment"
                                        Value="Stretch" />
                            </Style>
                            <Style TargetType="ComboBox">
                                <Setter Property="HorizontalAlignment"
                                        Value="Stretch" />
                            </Style>
                            <Style TargetType="DatePicker">
                                <Setter Property="HorizontalAlignment"
                                        Value="Stretch" />
                            </Style>
                            <Style TargetType="TimePicker">
                                <Setter Property="HorizontalAlignment"
                                        Value="Stretch" />
                            </Style>
                        </StackPanel.Resources>
                        <ItemsControl Style="{StaticResource ItensResponsivos}">
                            <StackPanel>
                                <TextBlock Text="Data e hora de emissão *" />
                                <DatePicker Date="{Binding DataEmissao, Mode=TwoWay}" />
                                <TimePicker Time="{Binding HoraEmissao, Mode=TwoWay}" />
                            </StackPanel>
                            <StackPanel>
                                <TextBlock Text="Data e hora de saída/entrada" />
                                <DatePicker Date="{Binding DataSaidaEntrada, Mode=TwoWay}" />
                                <TimePicker Time="{Binding HoraSaidaEntrada, Mode=TwoWay}" />
                            </StackPanel>
                        </ItemsControl>
                        <ItemsControl Style="{StaticResource ItensResponsivos}">
                            <TextBox Header="Série *"
                                     Text="{Binding Ident.Serie, Mode=TwoWay}" />
                            <TextBox Header="Número *"
                                     Text="{Binding Ident.Numero, Mode=TwoWay}" />
                            <ComboBox Header="Tipo de operação *"
                                      SelectedIndex="{Binding Ident.TipoOperação, Mode=TwoWay}">
                                <ComboBoxItem Content="Entrada" />
                                <ComboBoxItem Content="Saída" />
                            </ComboBox>
                            <ComboBox Header="Finalidade de emissão *"
                                      SelectedIndex="{Binding FinNFe, Mode=TwoWay}">
                                <ComboBoxItem Content="Normal" />
                                <ComboBoxItem Content="Complementar" />
                                <ComboBoxItem Content="De ajuste" />
                                <ComboBoxItem Content="Devolução de mercadoria" />
                            </ComboBox>
                            <ComboBox Header="Consumidor final *"
                                      SelectedIndex="{Binding Ident.OperaçãoConsumidorFinal, Mode=TwoWay}">
                                <ComboBoxItem Content="Não" />
                                <ComboBoxItem Content="Sim" />
                            </ComboBox>
                            <ComboBox Header="Tipo de atendimento *"
                                      SelectedIndex="{Binding Ident.IndicadorPresença, Mode=TwoWay}">
                                <ComboBoxItem Content="Não se aplica" />
                                <ComboBoxItem Content="Presencial" />
                                <ComboBoxItem Content="Não presencial - Internet" />
                                <ComboBoxItem Content="Não presencial - Teleatendimento" />
                            </ComboBox>
                            <ComboBox Header="Estado *"
                                      ItemsSource="{Binding Source={StaticResource estados}, Path=Nomes}"
                                      SelectedItem="{Binding Path=UFEscolhida, Mode=TwoWay}"
                                      PlaceholderText="Estado" />
                            <ComboBox Header="Forma de pagamento *"
                                      SelectedIndex="{Binding Ident.FormaPagamento, Mode=TwoWay}">
                                <ComboBoxItem Content="Pagamento à vista" />
                                <ComboBoxItem Content="Pagamento a prazo" />
                                <ComboBoxItem Content="Outros" />
                            </ComboBox>
                            <ComboBox Header="Tipo de NotaFácil.DANFE *"
                                      SelectedIndex="{Binding TipoDanfe, Mode=TwoWay}">
                                <ComboBoxItem Content="Retrato" />
                                <ComboBoxItem Content="Paisagem" />
                            </ComboBox>
                            <ComboBox Header="Destino da operação *"
                                      SelectedIndex="{Binding DestinoOperação, Mode=TwoWay}">
                                <ComboBoxItem Content="Operação interna" />
                                <ComboBoxItem Content="Operação interestadual" />
                                <ComboBoxItem Content="Operação com o exterior" />
                            </ComboBox>
                            <TextBox Header="Natureza da operação *"
                                     Text="{Binding Ident.NaturezaDaOperação, Mode=TwoWay}" />
                            <ComboBox Header="Município *"
                                      ItemsSource="{Binding Municipios}"
                                      SelectedItem="{Binding Path=MunicipioEscolhido, Mode=TwoWay}"
                                      PlaceholderText="Município" />
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Emitente"
                                Symbol="Contact" />
                </PivotItem.Header>
                <ScrollViewer ScrollViewer.VerticalScrollBarVisibility="Hidden">
                    <StackPanel>
                        <TextBlock Text="Escolha um emitente já cadastrado ou insira os valores manualmente nos campos abaixo."
                                   TextWrapping="Wrap" />
                        <ComboBox x:Name="cmbEmitentes"
                                  Grid.Column="1"
                                  HorizontalAlignment="Stretch"
                                  SelectionChanged="cmbEmitentes_SelectionChanged">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding nome}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <DadosBase:TelaEmitente DataContext="{Binding Emitente}"
                                                Margin="0,0,0,10" />
                    </StackPanel>
                </ScrollViewer>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Cliente"
                                Symbol="People" />
                </PivotItem.Header>
                <ScrollViewer ScrollViewer.VerticalScrollBarVisibility="Hidden">
                    <StackPanel>
                        <TextBlock Text="Escolha um cliente já cadastrado ou insira os valores manualmente nos campos abaixo."
                                   TextWrapping="Wrap" />
                        <ComboBox x:Name="cmbDestinatarios"
                                  Grid.Column="1"
                                  HorizontalAlignment="Stretch"
                                  SelectionChanged="cmbDestinatarios_SelectionChanged">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding nome}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <DadosBase:TelaDestinatario DataContext="{Binding Destinatario}"
                                                    Margin="0,0,0,10" />
                    </StackPanel>
                </ScrollViewer>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Produtos"
                                Symbol="Shop" />
                </PivotItem.Header>
                <ScrollViewer ScrollViewer.VerticalScrollBarVisibility="Hidden">
                    <Grid>
                        <Grid.Resources>
                            <Conversores:TextoComLabel x:Key="textoLabel" />
                            <x:String x:Key="LabelDescricao">Descrição</x:String>
                            <x:String x:Key="LabelQuantidade">Quant. comercializada</x:String>
                        </Grid.Resources>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <ComboBox x:Name="cmbProdutos"
                                  HorizontalAlignment="Stretch"
                                  Margin="0,0,2,0"
                                  PlaceholderText="Escolha um Produto">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Descricao}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <Button Grid.Column="1"
                                HorizontalAlignment="Stretch"
                                Margin="2,0,0,0"
                                Click="btnAdicionarProduto_Click">Adicionar</Button>
                        <ListView Grid.Row="1"
                                  Grid.ColumnSpan="2"
                                  ItemsSource="{Binding ProdutosObservableCollection}"
                                  Style="{StaticResource ListaCheia}">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,5">
                                        <StackPanel.ContextFlyout>
                                            <MenuFlyout Placement="Bottom">
                                                <MenuFlyoutItem Text="Remover"
                                                                Click="btnRemoverItemProdutos_Click" />
                                            </MenuFlyout>
                                        </StackPanel.ContextFlyout>
                                        <TextBlock Text="{Binding Path=Produto.Descricao, ConverterParameter={StaticResource LabelDescricao}, Converter={StaticResource textoLabel}}" />
                                        <TextBlock Text="{Binding Path=Produto.QuantidadeComercializada, ConverterParameter={StaticResource LabelQuantidade}, Converter={StaticResource textoLabel}}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>
                </ScrollViewer>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Totais"
                                Symbol="List" />
                </PivotItem.Header>
                <ScrollViewer ScrollViewer.VerticalScrollBarVisibility="Hidden">
                    <ScrollViewer VerticalScrollBarVisibility="Hidden"
                                  DataContext="{Binding Totais}">
                        <StackPanel>
                            <TextBlock Style="{StaticResource TitleTextBlockStyle}">ICMS</TextBlock>
                            <ItemsControl DataContext="{Binding ICMSTot}"
                                          Style="{StaticResource ItensResponsivos}">
                                <TextBox Text="{Binding vBC}"
                                         Header="Base de cálculo do ICMS"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vICMS}"
                                         Header="Total do ICMS"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vICMSDeson}"
                                         Header="Total do ICMS desonerado"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vBCST}"
                                         Header="Base de cálculo do ICMS ST"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vST}"
                                         Header="Total do ICMS ST"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vProd}"
                                         Header="Total dos produtos e serviços"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vFrete}"
                                         Header="Total do frete"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vSeg}"
                                         Header="Total do seguro"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vDesc}"
                                         Header="Total do desconto"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vII}"
                                         Header="Total do II"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vIPI}"
                                         Header="Total do IPI"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vPIS}"
                                         Header="Valor do PIS"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vCOFINS}"
                                         Header="Valor do COFINS"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vOutro}"
                                         Header="Outras despesas acessórias"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vNF}"
                                         Header="Total da NF-e"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vTotTrib}"
                                         Header="Total de tributos federais, estaduais e municipais"
                                         IsReadOnly="True" />
                            </ItemsControl>
                            <TextBlock Style="{StaticResource TitleTextBlockStyle}">ISSQN</TextBlock>
                            <ItemsControl DataContext="{Binding ISSQNtot}"
                                          Style="{StaticResource ItensResponsivos}">
                                <TextBox Text="{Binding vServ, Mode=TwoWay}"
                                         Header="Valor total dos serviços não tributados pelo ICMS"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vBC, Mode=TwoWay}"
                                         Header="Base de cálculo do ISSQN"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vISS, Mode=TwoWay}"
                                         Header="Valor total do ISS"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vPIS, Mode=TwoWay}"
                                         Header="Valor total do PIS"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vCOFINS, Mode=TwoWay}"
                                         Header="Valor total do COFINS"
                                         IsReadOnly="True" />
                                <DatePicker Date="{Binding DCompet, Mode=TwoWay}"
                                            Header="Data da prestação do serviço" />
                                <TextBox Text="{Binding vDeducao, Mode=TwoWay}"
                                         Header="Dedução para redução da base de cálculo"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vOutro, Mode=TwoWay}"
                                         Header="Outras retenções"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vDescIncond, Mode=TwoWay}"
                                         Header="Desconto incondicionado"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vDescCond, Mode=TwoWay}"
                                         Header="Desconto condicionado"
                                         IsReadOnly="True" />
                                <TextBox Text="{Binding vISSRet, Mode=TwoWay}"
                                         Header="Retenção ISS"
                                         IsReadOnly="True" />
                                <ComboBox SelectedIndex="{Binding CRegTrib, Mode=TwoWay}"
                                          Header="Regime especial de tributação">
                                    <ComboBoxItem>Microempresa municipal</ComboBoxItem>
                                    <ComboBoxItem>Estimativa</ComboBoxItem>
                                    <ComboBoxItem>Sociedade de profissionais</ComboBoxItem>
                                    <ComboBoxItem>Cooperativa</ComboBoxItem>
                                    <ComboBoxItem>Microempresário individual (MEI)</ComboBoxItem>
                                    <ComboBoxItem>Microempresário e empresa de pequeno porte</ComboBoxItem>
                                </ComboBox>
                            </ItemsControl>
                            <TextBlock Style="{StaticResource TitleTextBlockStyle}">Retenções de tributos</TextBlock>
                            <ItemsControl DataContext="{Binding retTrib}"
                                          Style="{StaticResource ItensResponsivos}">
                                <TextBox Text="{Binding vRetPIS, Mode=TwoWay}"
                                         Header="Valor retido de PIS" />
                                <TextBox Text="{Binding vRetCOFINS, Mode=TwoWay}"
                                         Header="Valor retido de COFINS" />
                                <TextBox Text="{Binding vRetCSLL, Mode=TwoWay}"
                                         Header="Valor retido de CSLL" />
                                <TextBox Text="{Binding vBCIRRF, Mode=TwoWay}"
                                         Header="Base de cálculo do IRRF" />
                                <TextBox Text="{Binding vIRRF, Mode=TwoWay}"
                                         Header="Valor retido do IRRF" />
                                <TextBox Text="{Binding vBCRetPrev, Mode=TwoWay}"
                                         Header="BC da retenção da Previdência soial" />
                                <TextBox Text="{Binding vRetPrev, Mode=TwoWay}"
                                         Header="Valor da retenção da PS" />
                            </ItemsControl>
                        </StackPanel>
                    </ScrollViewer>
                </ScrollViewer>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Transporte"
                                Symbol="Street" />
                </PivotItem.Header>
                <StackPanel DataContext="{Binding TransporteNota}">
                    <StackPanel.Resources>
                        <ResourceDictionary Source="Estilos/PivotSecundário.xaml" />
                    </StackPanel.Resources>
                    <ComboBox ItemsSource="{Binding Modalidades}"
                              SelectedItem="{Binding ModFrete, Mode=TwoWay}"
                              HorizontalAlignment="Stretch"
                              Header="Modalidade do frete" />
                    <Pivot>
                        <PivotItem Header="Motorista">
                            <DadosBase:TelaMotorista DataContext="{Binding Motorista}" />
                        </PivotItem>
                        <PivotItem Header="Veículo">
                            <ScrollViewer VerticalScrollBarVisibility="Hidden">
                                <ItemsControl Style="{StaticResource ItensResponsivos}">
                                    <StackPanel DataContext="{Binding VeicTransp, Mode=TwoWay}"
                                                Margin="2"
                                                MinWidth="300">
                                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">Veículo</TextBlock>
                                        <TextBox Text="{Binding Placa, Mode=TwoWay}"
                                                 Header="Placa" />
                                        <ComboBox ItemsSource="{Binding Source={StaticResource estados}, Path=Siglas}"
                                                  SelectedItem="{Binding Path=UF, Mode=TwoWay}"
                                                  Header="Estado"
                                                  HorizontalAlignment="Stretch" />
                                        <TextBox Header="RNTC"
                                                 Text="{Binding RNTC, Mode=TwoWay}" />
                                    </StackPanel>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition />
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.ColumnSpan="2"
                                                   Style="{StaticResource SubtitleTextBlockStyle}">Reboque</TextBlock>
                                        <StackPanel DataContext="{Binding NovoReboque}"
                                                    Grid.Row="1">
                                            <TextBox Text="{Binding Placa, Mode=TwoWay}"
                                                     Header="Placa" />
                                            <ComboBox ItemsSource="{Binding Source={StaticResource estados}, Path=Siglas}"
                                                      SelectedItem="{Binding Path=UF, Mode=TwoWay}"
                                                      Header="Estado"
                                                      HorizontalAlignment="Stretch" />
                                            <TextBox Header="RNTC"
                                                     Text="{Binding RNTC, Mode=TwoWay}" />
                                        </StackPanel>
                                        <Grid Grid.Column="1"
                                              Grid.Row="1">
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>
                                            <ListView ItemsSource="{Binding Reboques}"
                                                      SelectedIndex="{Binding IndexReboqueSelecionado, Mode=TwoWay}">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Placa, Mode=OneTime}" />
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                            </ListView>
                                            <StackPanel Grid.Row="1">
                                                <Button HorizontalAlignment="Stretch"
                                                        Command="{Binding AdicionarReboqueCommand}">Adicionar</Button>
                                                <Button HorizontalAlignment="Stretch"
                                                        Command="{Binding RemoverReboqueCommand}">Remover</Button>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>
                                    <StackPanel Margin="2">
                                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">Info adicional</TextBlock>
                                        <TextBox Text="{Binding Transp.balsa, Mode=TwoWay}"
                                                 Header="Identificação da balsa" />
                                        <TextBox Text="{Binding Transp.vagao, Mode=TwoWay}"
                                                 Header="Identificação do vagão" />
                                    </StackPanel>
                                </ItemsControl>
                            </ScrollViewer>
                        </PivotItem>
                        <PivotItem Header="Volumes">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <ListView ItemsSource="{Binding Volumes}"
                                          SelectedItem="{Binding VolumeSelecionado, Mode=TwoWay}"
                                          Grid.ColumnSpan="2"
                                          Style="{StaticResource ListaCheia}">
                                    <ListView.Header>
                                        <Grid>
                                            <TextBlock>Espécie</TextBlock>
                                            <TextBlock HorizontalAlignment="Right">Marca</TextBlock>
                                        </Grid>
                                    </ListView.Header>
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <TextBlock Text="{Binding esp, Mode=OneTime}" />
                                                <TextBlock HorizontalAlignment="Right"
                                                           Text="{Binding marca, Mode=OneTime}" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                                <Button Grid.Row="1"
                                        HorizontalAlignment="Stretch"
                                        Command="{Binding AdicionarVolumeCommand}">Adicionar</Button>
                                <Button Grid.Row="1"
                                        Grid.Column="1"
                                        HorizontalAlignment="Stretch"
                                        Command="{Binding RemoverVolumeCommand}">Remover</Button>
                            </Grid>
                        </PivotItem>
                        <PivotItem Header="Retenção ICMS">
                            <ItemsControl Style="{StaticResource ItensMedios}"
                                          DataContext="{Binding RetTransp, Mode=TwoWay}">
                                <TextBox Header="Valor do serviço" />
                                <TextBox Header="BC da retenção do ICMS" />
                                <TextBox Header="Alíquota da retenção" />
                                <TextBox Header="Valor do ICMS retido" />
                                <TextBox Header="CFOP" />
                                <ComboBox ItemsSource="{Binding Source={StaticResource estados}, Path=EstadosCompletos}"
                                          SelectedItem="{Binding Path=UFEscolhida, Mode=TwoWay}"
                                          Header="Estado"
                                          HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Nome, Mode=OneTime}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <ComboBox ItemsSource="{Binding Municipios}"
                                          SelectedItem="{Binding Path=MunicipioEscolhido, Mode=TwoWay}"
                                          Header="Município"
                                          HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Nome, Mode=OneWay}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </ItemsControl>
                        </PivotItem>
                    </Pivot>
                </StackPanel>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Cobrança"
                                Symbol="List" />
                </PivotItem.Header>
                <StackPanel x:Name="rootCobranca"
                            DataContext="{Binding Cobranca}">
                    <ItemsControl Style="{StaticResource ItensResponsivos}">
                        <TextBox Text="{Binding Fat.NFat, Mode=TwoWay}"
                                 Header="Número" />
                        <TextBox Text="{Binding Fat.VOrig, Mode=TwoWay}"
                                 Header="Valor original" />
                        <TextBox Text="{Binding Fat.VDesc, Mode=TwoWay}"
                                 Header="Valor do desconto" />
                        <TextBox Text="{Binding Fat.VLiq, Mode=TwoWay}"
                                 Header="Valor líquido" />
                    </ItemsControl>
                    <TextBlock Style="{StaticResource TitleTextBlockStyle}">Duplicatas</TextBlock>
                    <ListView ItemsSource="{Binding Cobranca.Dup, Converter={StaticResource getObs}}"
                              Grid.Column="1"
                              ItemContainerStyle="{StaticResource ItemFullWidth}">
                        <ListView.Header>
                            <Grid>
                                <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">Numero da duplicata</TextBlock>
                                <Button Style="{StaticResource BotaoAdd}"
                                        Command="{Binding AdicionarDuplicataCommand}">
                                    <SymbolIcon Symbol="Add" />
                                </Button>
                            </Grid>
                        </ListView.Header>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ContextFlyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem Command="{Binding ElementName=rootCobranca, Path=DataContext.RemoverDuplicataCommand}"
                                                            CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}}">Remover</MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Grid.ContextFlyout>
                                    <TextBlock Text="{Binding NDup, Mode=OneTime}" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Informações adicionais"
                                Symbol="Comment" />
                </PivotItem.Header>
                <StackPanel DataContext="{Binding InformacoesAdicionais}">
                    <TextBox Text="{Binding infAdFisco, Mode=TwoWay}"
                             Header="Informações adicionais de interesse do fisco" />
                    <TextBox Text="{Binding infCpl, Mode=TwoWay}"
                             Header="Informações complementares de interesse do contribuinte" />
                </StackPanel>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Exportação e compras"
                                Symbol="Switch" />
                </PivotItem.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <StackPanel DataContext="{Binding Exportacao}"
                                Margin="2">
                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">Exportação</TextBlock>
                        <TextBox Text="{Binding UFSaidaPais, Mode=TwoWay}"
                                 Header="UF embarque/transposição de fronteira" />
                        <TextBox Text="{Binding xLocExporta, Mode=TwoWay}"
                                 Header="DadosBase embarque/transposição de fronteira" />
                        <TextBox Text="{Binding xLocDespacho, Mode=TwoWay}"
                                 Header="DadosBase de despacho" />
                    </StackPanel>
                    <StackPanel DataContext="{Binding CompraNota}"
                                Grid.Column="1"
                                Margin="2">
                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">Compra</TextBlock>
                        <TextBox Text="{Binding XNEmp, Mode=TwoWay}"
                                 Header="Nota de empenho" />
                        <TextBox Text="{Binding XPed, Mode=TwoWay}"
                                 Header="Pedido" />
                        <TextBox Text="{Binding XCont, Mode=TwoWay}"
                                 Header="Contrato" />
                    </StackPanel>
                </Grid>
            </PivotItem>
            <PivotItem>
                <PivotItem.Header>
                    <ctrls:Guia Label="Cana"
                                Symbol="More" />
                </PivotItem.Header>
                <ScrollViewer x:Name="rootCana"
                              VerticalScrollBarVisibility="Hidden"
                              DataContext="{Binding Cana}">
                    <StackPanel>
                        <ItemsControl Style="{StaticResource ItensResponsivos}">
                            <TextBox Header="Safra"
                                     Text="{Binding Cana.safra, Mode=TwoWay}" />
                            <DatePicker DayVisible="False"
                                        Date="{Binding MesAnoReferencia, Mode=TwoWay}"
                                        Header="Mês e ano de referência" />
                            <TextBox Header="Quant. total do mês"
                                     Text="{Binding Cana.qTotMes, Mode=TwoWay}" />
                            <TextBox Header="Quant. total anterior"
                                     Text="{Binding Cana.qTotAnt, Mode=TwoWay}" />
                            <TextBox Header="Quant. total geral"
                                     Text="{Binding Cana.qTotGer, Mode=TwoWay}" />
                            <TextBox Header="Valor dos fornecimentos"
                                     Text="{Binding Cana.vFor, Mode=TwoWay}" />
                            <TextBox Header="Valor total da dedução"
                                     Text="{Binding Cana.vTotDed, Mode=TwoWay}" />
                            <TextBox Header="Valor líquido dos fornecimentos"
                                     Text="{Binding Cana.vLiqFor, Mode=TwoWay}" />
                        </ItemsControl>
                        <ItemsControl Style="{StaticResource ItensResponsivos}">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap"
                                           Margin="0,0,64,0"
                                           Style="{StaticResource TitleTextBlockStyle}">Fornecimento diário de cana</TextBlock>
                                <ListView ItemsSource="{Binding Cana.forDia, Converter={StaticResource getObs}}"
                                          ItemContainerStyle="{StaticResource ItemFullWidth}">
                                    <ListView.Header>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">Dia</TextBlock>
                                            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}"
                                                       Grid.Column="1">Quantidade</TextBlock>
                                            <Button Style="{StaticResource BotaoAdd}"
                                                    Grid.Column="1"
                                                    Command="{Binding AdicionarFornecimentoCommand}">
                                                <SymbolIcon Symbol="Add" />
                                            </Button>
                                        </Grid>
                                    </ListView.Header>
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <Grid.ContextFlyout>
                                                    <MenuFlyout Placement="Bottom">
                                                        <MenuFlyoutItem Text="Remover"
                                                                        Command="{Binding ElementName=rootCana, Path=DataContext.RemoverFornecimentoCommand}"
                                                                        CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}}" />
                                                    </MenuFlyout>
                                                </Grid.ContextFlyout>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding dia, Mode=OneTime}" />
                                                <TextBlock Text="{Binding qtde, Mode=OneTime}"
                                                           Grid.Column="1" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap"
                                           Style="{StaticResource TitleTextBlockStyle}">Deduções</TextBlock>
                                <ListView ItemsSource="{Binding Cana.deduc, Converter={StaticResource getObs}}"
                                          ItemContainerStyle="{StaticResource ItemFullWidth}">
                                    <ListView.Header>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">Descrição</TextBlock>
                                            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}"
                                                       Grid.Column="1">Valor</TextBlock>
                                            <Button Style="{StaticResource BotaoAdd}"
                                                    Grid.Column="1"
                                                    Command="{Binding AdicionarDeducaoCommand}">
                                                <SymbolIcon Symbol="Add" />
                                            </Button>
                                        </Grid>
                                    </ListView.Header>
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <Grid.ContextFlyout>
                                                    <MenuFlyout Placement="Bottom">
                                                        <MenuFlyoutItem Text="Remover"
                                                                        Command="{Binding ElementName=rootCana, Path=DataContext.RemoverDeducaoCommand}"
                                                                        CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}}" />
                                                    </MenuFlyout>
                                                </Grid.ContextFlyout>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding xDed, Mode=OneTime}" />
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding vDed, Mode=OneTime}" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </PivotItem>
        </Pivot>
        <CommandBar Grid.Row="1">
            <CommandBar.Background>
                <SolidColorBrush Color="{ThemeResource SystemChromeLowColor}" />
            </CommandBar.Background>
            <AppBarButton x:Name="btnConfirmar"
                          Icon="Accept"
                          Label="Confirmar"
                          Click="btnConfirmar_Click" />
            <AppBarButton x:Name="btnSalvar"
                          Icon="Save"
                          Label="Salvar"
                          Click="btnSalvar_Click" />
            <AppBarButton x:Name="btnAssinar"
                          Icon="Permissions"
                          Label="Assinar"
                          Click="btnAssinar_Click" />
            <AppBarButton x:Name="btnTransmitir"
                          Icon="Send"
                          Label="Transmitir"
                          Click="btnTransmitir_Click" />
            <AppBarButton x:Name="btnGerarDANFE"
                          Icon="Document"
                          Label="Gerar DANFE"
                          Click="btnGerarDANFE_Click" />
        </CommandBar>
    </Grid>
</Page>
